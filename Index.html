<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>å‹³é‰…æœƒè¨ˆç®¡ç†ç³»çµ±</title>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
<style>
body {
    font-family: Arial, "Microsoft JhengHei", sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ef 100%);
    font-size: 16px;
}

.container {
    max-width: 1400px;
    margin: 20px auto;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
}

.header {
    text-align: center;
    margin-bottom: 40px;
    padding: 20px;
    background: linear-gradient(90deg, #1a237e 0%, #0d47a1 100%);
    color: white;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.header h1 {
    font-size: 2.5em;
    margin: 0;
    padding: 10px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.nav {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    gap: 20px;
}

.nav button {
    padding: 12px 24px;
    border: none;
    background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
    color: white;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.1em;
    transition: all 0.3s ease;
    min-width: 160px;
}

.nav button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.form-group {
    margin-bottom: 25px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    font-size: 1.1em;
    color: #2c3e50;
}

input, select, textarea {
    text-align: center;
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    box-sizing: border-box;
    font-size: 1.1em;
    transition: border-color 0.3s ease;
}

input:focus, select:focus {
    border-color: #1e88e5;
    outline: none;
}

table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    border-radius: 12px;
    overflow: hidden;
    animation: tableLoad 0.6s ease-out;
    table-layout: fixed; 
}

th, td {
    border: none;
    border-bottom: 1px solid #e0e0e0;
    padding: 18px 25px;
    text-align: center; 
    font-size: 1.1em;
    transition: all 0.3s ease;
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
    min-width: 50px;
}

td {
    position: relative; 
}

td:hover::after {
    content: attr(data-full-text);
    position: absolute;
    left: 0;
    top: 100%;
    background: white;
    padding: 5px;
    border: 1px solid #ddd;
    border-radius: 4px;
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    white-space: normal;
    max-width: 300px;
    display: none;
}

td[data-full-text]:hover::after {
    display: block;
}

table thead tr th:nth-child(2), 
table tbody tr td:nth-child(2) {
    min-width: 200px; /* Increased from 180px */
    max-width: 300px; /* Increased from 250px */
}

table thead tr th:nth-child(3), 
table tbody tr td:nth-child(3) {
    min-width: 120px;
    max-width: 150px;
}

table thead tr th:nth-child(1), 
table tbody tr td:nth-child(1) {
  min-width: 200px;
  max-width: 300px;
}

td input {
  width: 95%;
  min-width: 100px;
  text-align: center;
}

th {
    background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
    color: white;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 1.05em;
    white-space: nowrap;
}

tr:last-child td {
    border-bottom: none;
}

tr:nth-child(even) {
    background-color: #f8f9fa;
}

tr:hover {
    background-color: #e3f2fd;
    transition: background-color 0.3s ease;
}

td input,
td select {
    min-width: 100px;
    text-align: center; 
}

td select {
    min-width: 100px;
    text-align: center;
    padding: 5px;
}

.search-box {
    margin: 20px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.search-box label {
    color: #1565c0;
    font-weight: bold;
    margin-bottom: 10px;
}

.search-box input {
    width: 100%;
    padding: 12px 15px 12px 40px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1.1em;
    background: white url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23999999"><path d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>') no-repeat 10px center;
    background-size: 20px;
    transition: all 0.3s ease;
    text-align: center; 
}

.search-box input:focus {
    border-color: #1e88e5;
    box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
    outline: none;
}

.summary {
    margin-top: 30px;
    padding: 25px;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ef 100%);
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.summary h3 {
    color: #1565c0;
    margin-top: 0;
    font-size: 1.4em;
}

.summary p {
    font-size: 1.2em;
    margin: 10px 0;
    color: #2c3e50;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-right: 10px;
    font-size: 1.1em;
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.btn-primary {
    background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
    color: white;
}

.btn-success {
    background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
    color: white;
}

.btn-danger {
    background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
    color: white;
    margin-left: 5px;
}

.btn-danger:hover {
    background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.btn-warning {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    color: white;
    margin-right: 5px;
}

.adjustment-input {
    width: 80px;
    display: inline-block;
    margin: 0 5px;
    text-align: center; 
}

h2 {
    color: #1565c0;
    font-size: 2em;
    margin-bottom: 30px;
    padding-bottom: 10px;
    border-bottom: 3px solid #1565c0;
}

.chart-section {
    margin-top: 30px;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    width: 80%; /* Increased size */
    height: 500px; /* Increased height */
    margin-left: auto;
    margin-right: auto;
}

.chart-controls {
    margin-bottom: 20px;
}

.chart-controls select {
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ddd;
    margin-left: 10px;
}

.inventory-summary-section {
    margin: 20px 0;
}

.inventory-dashboard {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.current-time {
    color: #666;
    font-size: 1.1em;
}

.inventory-summary-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}

.inventory-summary-card h4 {
    color: #1565c0;
    margin-bottom: 15px;
}

.summary-table table {
    width: 100%;
    margin-top: 0;
}

.status-low {
    color: #e53935;
    font-weight: bold;
}

.status-ok {
    color: #43a047;
    font-weight: bold;
}

.status-warning {
    color: #ff9800;
    font-weight: bold;
}

.status-critical {
    color: #f44336;
    font-weight: bold;
}

.status-pending {
  color: #ff9800;
  font-weight: bold;
}

.status-completed {
  color: #4caf50;
  font-weight: bold;
}

.dashboard-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

@media (max-width: 768px) {
    .container {
        padding: 15px;
        margin: 10px;
    }
    
    .nav {
        flex-direction: column;
    }
    
    .nav button {
        width: 100%;
        margin-bottom: 10px;
    }
    
    .dashboard-content {
        grid-template-columns: 1fr;
    }
}

@keyframes tableLoad {
    0% {
        opacity: 0;
        transform: translateY(10px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

input[list] {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    box-sizing: border-box;
    font-size: 1.1em;
    transition: border-color 0.3s ease;
    text-align: center; 
}

input[list]:focus {
    border-color: #1e88e5;
    outline: none;
}

input[list]::placeholder {
    color: #999;
    font-style: italic;
}

.save-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 15px 25px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideIn 0.3s ease-out;
}

.save-toast i {
    font-size: 1.2em;
}

.save-toast.fade-out {
    animation: fadeOut 0.3s ease-out forwards;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

.resizable-table th {
  position: relative;
  user-select: none;
}

.resizer {
  position: absolute;
  top: 0;
  right: 0;
  width: 5px;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  cursor: col-resize;
  opacity: 0;
  transition: opacity 0.3s;
}

.resizer:hover,
.resizing {
  opacity: 1;
}

.stock-info {
  margin-top: 5px;
  font-size: 0.9em;
  color: #666;
}

.stock-warning {
  color: #e53935;
  font-weight: bold;
  margin-left: 10px;
}
</style>

<body>
<div class="container" id="app">
<div style="text-align:right; margin: 10px 0;">
<button @click="exportData" class="btn btn-success">ğŸ“¤ åŒ¯å‡ºè³‡æ–™</button>
<input @change="importData" style="display:inline-block; margin-left:10px;" type="file"/>
</div>

<div class="header">
<h1>å‹³é‰…æœƒè¨ˆç®¡ç†ç³»çµ±</h1>
</div>
<div class="nav">
<button @click="currentView='transactions'"><i class="fas fa-exchange-alt"></i> è¨‚å–®é€²å‡ºè²¨è¨˜éŒ„</button>
<button @click="currentView='vendors'"><i class="fas fa-building"></i> å» å•†ç®¡ç†</button>
<button @click="currentView='inventory'"><i class="fas fa-warehouse"></i> åº«å­˜ç®¡ç†</button>
<button @click="currentView='reports'"><i class="fas fa-chart-bar"></i> æœˆå ±è¡¨</button>
<button @click="currentView='finance'"><i class="fas fa-file-invoice-dollar"></i> è²¡å‹™ç®¡ç†</button>
</div>
<!-- é€²å‡ºè²¨ç´€éŒ„ -->
<div v-if="currentView === 'transactions'">
<h2>è¨‚å–®é€²å‡ºè²¨è¨˜éŒ„</h2>
<div class="search-box">
<label>æŸ¥è©¢äº¤æ˜“ç´€éŒ„:</label>
<input placeholder="æŸ¥è©¢æ—¥æœŸã€å•†å“æˆ–äº¤æ˜“é¡å‹" type="text" v-model="searchQuery"/>
</div>
<div class="alert alert-info" v-if="!transactions || transactions.length === 0">
          ç›®å‰æ²’æœ‰äº¤æ˜“ç´€éŒ„
        </div>
<div class="form-group">
<label>å» å•†å…¬å¸</label>
<select v-model="newTransaction.vendor">
<option value="">è«‹é¸æ“‡å» å•†</option>
<option :value="vendor.name" v-for="vendor in vendors">{{vendor.name}} (çµ±ç·¨: {{vendor.taxId}})</option>
</select>
</div>
<div class="form-group">
<label>äº¤æ˜“é¡å‹</label>
<select v-model="newTransaction.type">
<option value="in">é€²è²¨</option>
<option value="out">å‡ºè²¨</option>
</select>
</div>
<div class="form-group">
<label>æ—¥æœŸ</label>
<input type="date" v-model="newTransaction.date"/>
</div>
<div class="form-group">
<label>å•†å“</label>
<select v-model="newTransaction.item">
<option value="">è«‹é¸æ“‡å•†å“</option>
<option :key="item" :value="item" v-for="item in sampleOptions">{{item}}</option>
</select>
<div class="stock-info" v-if="newTransaction.item">
                ç›®å‰åº«å­˜: {{ currentStockLevels[newTransaction.item] || 0 }}
                <span class="stock-warning" v-if="newTransaction.type === 'out' &amp;&amp; newTransaction.quantity &gt; (currentStockLevels[newTransaction.item] || 0)">
                  åº«å­˜ä¸è¶³!
                </span>
</div>
</div>
<div class="form-group">
<label>æ•¸é‡</label>
<input type="number" v-model="newTransaction.quantity"/>
</div>
<div class="form-group">
<label>å–®åƒ¹</label>
<input type="number" v-model="newTransaction.price"/>
</div>
<div class="form-group">
<label>èªªæ˜</label>
<input placeholder="èªªæ˜" type="text" v-model="newTransaction.remarks"/>
</div>
<button @click="addTransaction" class="btn btn-primary">æ–°å¢äº¤æ˜“</button>
<table class="resizable-table">
<thead>
<tr>
<th>ç‹€æ…‹</th>
<th>å» å•†å…¬å¸</th>
<th>æ—¥æœŸ</th>
<th>é¡å‹</th>
<th>å•†å“</th>
<th>èªªæ˜</th>
<th>æ•¸é‡</th>
<th>å–®åƒ¹</th>
<th>ç¸½è¨ˆ</th>
<th>å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr :key="index" v-for="(transaction, index) in filteredTransactions">
<template v-if="editingItem === index">
<td>
<select v-model="editForm.completed">
<option value="pending">è™•ç†ä¸­</option>
<option value="completed">å·²å®Œæˆ</option>
</select>
</td>
<td>
<select v-model="editForm.vendor">
<option :value="vendor.name" v-for="vendor in vendors">{{vendor.name}}</option>
</select>
</td>
<td><input type="date" v-model="editForm.date"/></td>
<td>
<select v-model="editForm.type">
<option value="in">é€²è²¨</option>
<option value="out">å‡ºè²¨</option>
</select>
</td>
<td>
<select v-model="editForm.item">
<option :key="item" :value="item" v-for="item in sampleOptions">{{item}}</option>
</select>
</td>
<td><input type="text" v-model="editForm.remarks"/></td>
<td><input type="number" v-model="editForm.quantity"/></td>
<td><input type="number" v-model="editForm.price"/></td>
<td>{{ editForm.quantity * editForm.price }}</td>
<td>
<button @click="saveTransactionEdit" class="btn btn-success">å„²å­˜</button>
<button @click="cancelEdit" class="btn btn-danger">å–æ¶ˆ</button>
</td>
</template>
<template v-else="">
<td>{{ transaction.completed === 'completed' ? 'å·²å®Œæˆ' : 'è™•ç†ä¸­' }}</td>
<td :data-full-text="transaction.vendorTooltip">{{ transaction.vendorDisplay }}</td>
<td :data-full-text="transaction.dateDisplay">{{ transaction.dateDisplay }}</td>
<td>{{ transaction.type === 'in' ? 'é€²è²¨' : 'å‡ºè²¨' }}</td>
<td>{{ transaction.item }}</td>
<td>{{ transaction.remarks }}</td>
<td>{{ transaction.quantity }}</td>
<td>{{ transaction.price }}</td>
<td>{{ transaction.quantity * transaction.price }}</td>
<td>
<button @click="editTransaction(index)" class="btn btn-primary">ç·¨è¼¯</button>
<button @click="deleteRecordByType('transaction', index)" class="btn btn-danger">åˆªé™¤</button>
</td>
</template>
</tr>
</tbody>
</table>
<div class="summary">
<h3>æ‘˜è¦</h3>
<p>é€²è²¨ç¸½è¨ˆ:{{ inTotal }}</p>
<p>å‡ºè²¨ç¸½è¨ˆ:{{ outTotal }}</p>
<p>ç›ˆé¤˜:{{ balance }}</p>
</div>
<div class="chart-section">
<div class="chart-controls">
<label>åœ–è¡¨é¡å‹:</label>
<select @change="updateChart" v-model="selectedChart">
<option :value="type.value" v-for="type in chartTypes">{{type.label}}</option>
</select>
</div>
<canvas height="200" id="transactionChart" width="400"></canvas>
</div>
</div>
<!-- å» å•†ç®¡ç† -->
<div v-if="currentView === 'vendors'">
<h2>å» å•†ç®¡ç†</h2>
<div class="search-box">
<label>æŸ¥è©¢å» å•†è³‡æ–™:</label>
<input placeholder="æŸ¥è©¢å» å•†åç¨±ã€çµ±ä¸€ç·¨è™Ÿã€è¯ç¹«äººæˆ–é›»è©±" type="text" v-model="vendorSearchQuery"/>
</div>
<div class="form-group">
<label>å» å•†åç¨±</label>
<input type="text" v-model="newVendor.name"/>
</div>
<div class="form-group">
<label>çµ±ä¸€ç·¨è™Ÿ</label>
<input type="text" v-model="newVendor.taxId"/>
</div>
<div class="form-group">
<label>è¯ç¹«äºº</label>
<input type="text" v-model="newVendor.contact"/>
</div>
<div class="form-group">
<label>é›»è©±</label>
<input type="text" v-model="newVendor.phone"/>
</div>
<div class="form-group">
<label>å‚³çœŸ</label>
<input type="text" v-model="newVendor.fax"/>
</div>
<div class="form-group">
<label>å…¬å¸åœ°å€</label>
<input type="text" v-model="newVendor.address"/>
</div>
<div class="form-group">
<label>å‚™è¨»</label>
<input type="text" v-model="newVendor.memo"/>
</div>
<button @click="addVendor" class="btn btn-primary">æ–°å¢å» å•†</button>
<table class="vendor-table">
<thead>
<tr>
<th>å» å•†åç¨±</th>
<th>çµ±ä¸€ç·¨è™Ÿ</th>
<th>è¯ç¹«äºº</th>
<th>é›»è©±</th>
<th>å‚³çœŸ</th>
<th>å…¬å¸åœ°å€</th>
<th>å‚™è¨»</th>
<th>å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr :key="index" v-for="(vendor, index) in filteredVendors">
<template v-if="editingItem === index">
<td><input type="text" v-model="editForm.name"/></td>
<td><input type="text" v-model="editForm.taxId"/></td>
<td><input type="text" v-model="editForm.contact"/></td>
<td><input type="text" v-model="editForm.phone"/></td>
<td><input type="text" v-model="editForm.fax"/></td>
<td><input type="text" v-model="editForm.address"/></td>
<td><input type="text" v-model="editForm.memo"/></td>
<td>
<button @click="saveVendorEdit" class="btn btn-success">å„²å­˜</button>
<button @click="cancelEdit" class="btn btn-danger">å–æ¶ˆ</button>
</td>
</template>
<template v-else="">
<td>{{ vendor.name }}</td>
<td>{{ vendor.taxId }}</td>
<td>{{ vendor.contact }}</td>
<td>{{ vendor.phone }}</td>
<td>{{ vendor.fax }}</td>
<td>{{ vendor.address }}</td>
<td>{{ vendor.memo }}</td>
<td>
<button @click="editVendor(index)" class="btn btn-primary">ç·¨è¼¯</button>
<button @click="deleteVendor(index)" class="btn btn-danger">åˆªé™¤</button>
</td>
</template>
</tr>
</tbody>
</table>
</div>
<!-- åº«å­˜ç®¡ç† -->
<div v-if="currentView === 'inventory'">
<h2>åº«å­˜ç®¡ç†</h2>
<div class="nav" style="background: #f8f9fa;">
<button @click="inventoryType='screws'">èºçµ²åº«å­˜ç®¡ç†</button>
<button @click="inventoryType='samples'">æ¨£å“åº«å­˜ç®¡ç†</button>
</div>
<!-- èºçµ²åº«å­˜ç®¡ç† -->
<div v-if="inventoryType === 'screws'">
<h3>èºçµ²åº«å­˜ç®¡ç†</h3>
<div class="search-box">
<label>æŸ¥è©¢èºçµ²åº«å­˜:</label>
<input placeholder="æŸ¥è©¢åç¨±æˆ–è¦æ ¼" type="text" v-model="screwSearchQuery"/>
</div>
<div class="form-group">
<label>èºçµ²åç¨±</label>
<input list="screwNameSuggestions" placeholder="ä¾‹å¦‚ï¼šå…¨é ­(4*10)" type="text" v-model="newScrew.name"/>
<datalist id="screwNameSuggestions">
<option value="å…¨ç‰™(4*10.5)">
<option value="å…¨ç‰™(4*12.5)">
<option value="å…¨ç‰™(4*13)">
<option value="åŠç‰™(4*12.5)">
<option value="ç‰¹æ®ŠåŠç‰™(4*12.5)">
<option value="çŸ­èºçµ²(4*7)">
<option value="èºæ¯">
<option value="è¯å¸">
<option value="ç‰¹å°è´è¶ç‰‡">
<option value="ä¸€èˆ¬è´è¶ç‰‡">
<option value="15Pè´è¶ç‰‡">
<option value="ç‰¹å¤§è´è¶ç‰‡">
<option value="ä¸€èˆ¬é•·èºçµ²">
<option value="å‰–æºé•·èºçµ²">
</option></option></option></option></option></option></option></option></option></option></option></option></option></option></datalist>
</div>
<div class="form-group">
<label>ç¾å­˜æ•¸é‡</label>
<input type="number" v-model="newScrew.quantity"/>
</div>
<div class="form-group">
<label>å®‰å…¬åº«å­˜é‡</label>
<input type="number" v-model="newScrew.safetyStock"/>
</div>
<button @click="addScrew" class="btn btn-primary">æ–°å¢èºçµ²åº«å­˜</button>
<table>
<thead>
<tr>
<th>åç¨±</th>
<th>ç¾å­˜æ•¸é‡</th>
<th>å®‰å…¬åº«å­˜é‡</th>
<th>åº«å­˜ç‹€æ…‹</th>
<th>å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr :key="index" v-for="(screw, index) in filteredScrews">
<template v-if="editingItem === index">
<td><input list="screwNameSuggestions" type="text" v-model="editForm.name"/></td>
<td><input type="number" v-model="editForm.quantity"/></td>
<td><input type="number" v-model="editForm.safetyStock"/></td>
<td>{{ editForm.quantity &lt; editForm.safetyStock ? 'åº«å­˜ä¸è¶³' : 'åº«å­˜å……è¶³' }}</td>
<td>
<button @click="saveScrewEdit" class="btn btn-success">å„²å­˜</button>
<button @click="cancelEdit" class="btn btn-danger">å–æ¶ˆ</button>
</td>
</template>
<template v-else="">
<td>{{ screw.name }}</td>
<td>{{ screw.quantity }}</td>
<td>{{ screw.safetyStock }}</td>
<td :class="screw.statusClass">{{ screw.status }}</td>
<td>
<button @click="editScrew(index)" class="btn btn-primary">ç·¨è¼¯</button>
<button @click="deleteRecordByType('screw', index)" class="btn btn-danger">åˆªé™¤</button>
</td>
</template>
</tr>
</tbody>
</table>
<div class="chart-section">
<div class="chart-controls">
<label>åœ–è¡¨é¡å‹:</label>
<select @change="updateInventoryChart" v-model="selectedChart">
<option :value="type.value" v-for="type in chartTypes">{{type.label}}</option>
</select>
</div>
<canvas height="200" id="inventoryChart" width="400"></canvas>
</div>
<div class="inventory-summary-section">
<button @click="showInventorySummary = !showInventorySummary" class="btn btn-primary">
<i class="fas fa-clipboard-list"></i> 
                    {{ showInventorySummary ? 'éš±è—åº«å­˜æ‘˜è¦' : 'é¡¯ç¤ºåº«å­˜æ‘˜è¦' }}
                </button>
<div class="inventory-dashboard" v-if="showInventorySummary">
<div class="dashboard-header">
<h3>ç›®å‰åº«å­˜æ‘˜è¦</h3>
<p class="current-time">æ›´æ–°æ™‚é–“ï¼š{{ currentDateTime }}</p>
</div>
<div class="dashboard-content">
<div class="inventory-summary-card">
<h4>èºçµ²åº«å­˜æ¦‚è¦½</h4>
<div class="summary-table">
<table>
<thead>
<tr>
<th>å•†å“</th>
<th>æ•¸é‡</th>
<th>ç‹€æ…‹</th>
</tr>
</thead>
<tbody>
<tr :key="item.name" v-for="item in currentInventorySummary.screws">
<td>{{ item.name }}</td>
<td>{{ item.quantity }}</td>
<td :class="item.status === 'åº«å­˜ä¸è¶³' ? 'status-low' : 'status-ok'">
                                                {{ item.status }}
                                            </td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="inventory-summary-card">
<h4>æ¨£å“åº«å­˜æ¦‚è¦½</h4>
<div class="summary-table">
<table>
<thead>
<tr>
<th>æ¨£å“ç·¨è™Ÿ</th>
<th>å•†å“</th>
<th>æ•¸é‡</th>
<th>ä½ç½®</th>
<th>å‹•ä½œ</th>
<th>æ›´æ–°æ™‚é–“</th>
</tr>
</thead>
<tbody>
<tr :key="sample.code" v-for="(sample, index) in currentInventorySummary.samples">
<td>{{ sample.code }}</td>
<td>{{ sample.name }}</td>
<td>{{ sample.quantity }}</td>
<td>{{ sample.location }}</td>
<td>
<button @click="adjustInventory(index, 'in')" class="btn btn-success">å…¥åº« +</button>
<button @click="adjustInventory(index, 'out')" class="btn btn-warning">å‡ºåº« -</button>
<input class="adjustment-input" placeholder="æ•¸é‡" type="number" v-model="adjustmentAmount"/>
</td>
<td>{{sample.lastUpdated}}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- æ¨£å“åº«å­˜ç®¡ç† -->
<div v-if="inventoryType === 'samples'">
<h3>æ¨£å“åº«å­˜ç®¡ç†</h3>
<div class="search-box">
<label>æŸ¥è©¢æ¨£å“åº«å­˜:</label>
<input placeholder="æŸ¥è©¢æ¨£å“åç¨±" type="text" v-model="sampleSearchQuery"/>
</div>
<div class="form-group">
<label>æ¨£å“åç¨±</label>
<select v-model="newSample.name">
<option value="">è«‹é¸æ“‡æ¨£å“åç¨±</option>
<option :key="item" :value="item" v-for="item in sampleOptions">{{item}}</option>
</select>
</div>
<div class="form-group">
<label>ç¾å­˜æ•¸é‡</label>
<input type="number" v-model="newSample.quantity"/>
</div>
<div class="form-group">
<label>å®‰å…¬åº«å­˜é‡</label>
<input type="number" v-model="newSample.safetyStock"/>
</div>
<button @click="addSample" class="btn btn-primary">æ–°å¢æ¨£å“åº«å­˜</button>
<table>
<thead>
<tr>
<th>æ¨£å“åç¨±</th>
<th>ç¾å­˜æ•¸é‡</th>
<th>å®‰å…¬åº«å­˜é‡</th>
<th>åº«å­˜ç‹€æ…‹</th>
<th>å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr :key="index" v-for="(sample, index) in filteredSamples">
<template v-if="editingItem === index">
<td>
<select v-model="editForm.name">
<option :key="item" :value="item" v-for="item in sampleOptions">{{item}}</option>
</select>
</td>
<td><input type="number" v-model="editForm.quantity"/></td>
<td><input type="number" v-model="editForm.safetyStock"/></td>
<td>{{ editForm.quantity &lt; editForm.safetyStock ? 'åº«å­˜ä¸è¶³' : 'åº«å­˜å……è¶³' }}</td>
<td>
<button @click="saveSampleEdit" class="btn btn-success">å„²å­˜</button>
<button @click="cancelEdit" class="btn btn-danger">å–æ¶ˆ</button>
</td>
</template>
<template v-else="">
<td>{{ sample.name }}</td>
<td>{{ sample.quantity }}</td>
<td>{{ sample.safetyStock }}</td>
<td :class="sample.statusClass">{{ sample.status }}</td>
<td>
<button @click="editSample(index)" class="btn btn-primary">ç·¨è¼¯</button>
<button @click="deleteRecordByType('sample', index)" class="btn btn-danger">åˆªé™¤</button>
</td>
</template>
</tr>
</tbody>
</table>
<div class="chart-section">
<div class="chart-controls">
<label>åœ–è¡¨é¡å‹:</label>
<select @change="updateSampleInventoryChart" v-model="sampleChartType">
<option value="bar">é•·æ¢åœ–</option>
<option value="line">æŠ˜ç·šåœ–</option>
<option value="pie">åœ“é¤…åœ–</option>
<option value="doughnut">ç’°å½¢åœ–</option>
</select>
</div>
<canvas height="400" id="sampleInventoryChart" width="800"></canvas>
</div>
<div class="summary">
<h3>æ¨£å“åº«å­˜æ‘˜è¦</h3>
<p>åº«å­˜ä¸è¶³æ¨£å“: {{ lowStockSamples }}</p>
</div>
</div>
</div>
<!-- æœˆå ±è¡¨ -->
<div v-if="currentView === 'reports'">
<h2>æœˆå ±è¡¨</h2>
<div class="search-box">
<label>æŸ¥è©¢å ±è¡¨:</label>
<input placeholder="æŸ¥è©¢æœˆä»½" type="text" v-model="reportSearchQuery"/>
</div>
<div class="form-group">
<label>é¸æ“‡æœˆä»½</label>
<input type="month" v-model="selectedMonth"/>
</div>
<div class="summary">
<h3>{{ selectedMonth }} æœˆå ±è¡¨</h3>
<p>æœ¬æœˆé€²è²¨ç¸½è¨ˆ:{{ monthlyInTotal }}</p>
<p>æœ¬æœˆå‡ºè²¨ç¸½è¨ˆ:{{ monthlyOutTotal }}</p>
<p>æœ¬æœˆç›ˆé¤˜:{{ monthlyBalance }}</p>
</div>
</div>
<!-- è²¡å‹™ç®¡ç† -->
<div v-if="currentView === 'finance'">
<h2>è²¡å‹™ç®¡ç†</h2>
<div class="nav" style="background: #f8f9fa;">
<button @click="financeType='receivable'">æ‡‰æ”¶å¸³æ¬¾</button>
<button @click="financeType='payable'">æ‡‰ä»˜å¸³æ¬¾</button>
<button @click="financeType='tax'">ç‡Ÿæ¥­ç¨…ç”³å ±</button>
</div>
<!-- æ‡‰æ”¶å¸³æ¬¾ -->
<div v-if="financeType === 'receivable'">
<h3>æ‡‰æ”¶å¸³æ¬¾ç®¡ç†</h3>
<div class="search-box">
<label>æŸ¥è©¢æ‡‰æ”¶å¸³æ¬¾:</label>
<input placeholder="æŸ¥è©¢å» å•†æˆ–æ—¥æœŸ" type="text" v-model="receivableSearch"/>
</div>
<div class="form-group">
<label>æ—¥æœŸ</label>
<input type="date" v-model="newReceivable.date"/>
</div>
<div class="form-group">
<label>å» å•†</label>
<select v-model="newReceivable.vendor">
<option :value="vendor.name" v-for="vendor in vendors">{{vendor.name}}</option>
</select>
</div>
<div class="form-group">
<label>é‡‘é¡</label>
<input type="number" v-model="newReceivable.amount"/>
</div>
<div class="form-group">
<label>åˆ°æœŸæ—¥</label>
<input type="date" v-model="newReceivable.dueDate"/>
</div>
<button @click="addReceivable" class="btn btn-primary">æ–°å¢æ‡‰æ”¶å¸³æ¬¾</button>
<table>
<thead>
<tr>
<th>æ—¥æœŸ</th>
<th>å» å•†</th>
<th>é‡‘é¡</th>
<th>åˆ°æœŸæ—¥</th>
<th>ç‹€æ…‹</th>
<th>å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr :key="index" v-for="(item, index) in filteredReceivables">
<template v-if="editingItem === index">
<td><input type="date" v-model="editForm.date"/></td>
<td>
<select v-model="editForm.vendor">
<option :value="vendor.name" v-for="vendor in vendors">{{vendor.name}}</option>
</select>
</td>
<td><input type="number" v-model="editForm.amount"/></td>
<td><input type="date" v-model="editForm.dueDate"/></td>
<td>
<select v-model="editForm.status">
<option value="pending">æœªæ”¶æ¬¾</option>
<option value="paid">å·²æ”¶æ¬¾</option>
</select>
</td>
<td>
<button @click="saveReceivableEdit" class="btn btn-success">å„²å­˜</button>
<button @click="cancelEdit" class="btn btn-danger">å–æ¶ˆ</button>
</td>
</template>
<template v-else="">
<td>{{item.date}}</td>
<td>{{item.vendor}}</td>
<td>{{item.amount}}</td>
<td>{{item.dueDate}}</td>
<td>{{item.status === 'pending' ? 'æœªæ”¶æ¬¾' : 'å·²æ”¶æ¬¾'}}</td>
<td>
<button @click="markAsPaid(index, 'receivable')" class="btn btn-success" v-if="item.status === 'pending'">æ¨™è¨˜ç‚ºå·²æ”¶æ¬¾</button>
<button @click="editReceivable(index)" class="btn btn-primary">ç·¨è¼¯</button>
<button @click="deleteRecordByType('receivable', index)" class="btn btn-danger">åˆªé™¤</button>
</td>
</template>
</tr>
</tbody>
</table>
<div class="summary">
<h3>æ‡‰æ”¶å¸³æ¬¾æ‘˜è¦</h3>
<p>æœªæ”¶æ¬¾ç¸½è¨ˆ:{{ pendingReceivableTotal }}</p>
<p>å·²æ”¶æ¬¾ç¸½è¨ˆ:{{ paidReceivableTotal }}</p>
</div>
<div class="chart-section">
<div class="chart-controls">
<label>åœ–è¡¨é¡å‹:</label>
<select @change="updateFinanceChart" v-model="selectedChart">
<option :value="type.value" v-for="type in chartTypes">{{type.label}}</option>
</select>
</div>
<canvas height="200" id="financeChart" width="400"></canvas>
</div>
</div>
<!-- æ‡‰ä»˜å¸³æ¬¾ -->
<div v-if="financeType === 'payable'">
<h3>æ‡‰ä»˜å¸³æ¬¾ç®¡ç†</h3>
<div class="search-box">
<label>æŸ¥è©¢æ‡‰ä»˜å¸³æ¬¾:</label>
<input placeholder="æŸ¥è©¢å» å•†æˆ–æ—¥æœŸ" type="text" v-model="payableSearch"/>
</div>
<div class="form-group">
<label>æ—¥æœŸ</label>
<input type="date" v-model="newPayable.date"/>
</div>
<div class="form-group">
<label>å» å•†</label>
<select v-model="newPayable.vendor">
<option :value="vendor.name" v-for="vendor in vendors">{{vendor.name}}</option>
</select>
</div>
<div class="form-group">
<label>é‡‘é¡</label>
<input type="number" v-model="newPayable.amount"/>
</div>
<div class="form-group">
<label>åˆ°æœŸæ—¥</label>
<input type="date" v-model="newPayable.dueDate"/>
</div>
<button @click="addPayable" class="btn btn-primary">æ–°å¢æ‡‰ä»˜å¸³æ¬¾</button>
<table>
<thead>
<tr>
<th>æ—¥æœŸ</th>
<th>å» å•†</th>
<th>é‡‘é¡</th>
<th>åˆ°æœŸæ—¥</th>
<th>ç‹€æ…‹</th>
<th>å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr :key="index" v-for="(item, index) in filteredPayables">
<template v-if="editingItem === index">
<td><input type="date" v-model="editForm.date"/></td>
<td>
<select v-model="editForm.vendor">
<option :value="vendor.name" v-for="vendor in vendors">{{vendor.name}}</option>
</select>
</td>
<td><input type="number" v-model="editForm.amount"/></td>
<td><input type="date" v-model="editForm.dueDate"/></td>
<td>
<select v-model="editForm.status">
<option value="pending">æœªä»˜æ¬¾</option>
<option value="paid">å·²ä»˜æ¬¾</option>
</select>
</td>
<td>
<button @click="savePayableEdit" class="btn btn-success">å„²å­˜</button>
<button @click="cancelEdit" class="btn btn-danger">å–æ¶ˆ</button>
</td>
</template>
<template v-else="">
<td>{{item.date}}</td>
<td>{{item.vendor}}</td>
<td>{{item.amount}}</td>
<td>{{item.dueDate}}</td>
<td>{{item.status === 'pending' ? 'æœªä»˜æ¬¾' : 'å·²ä»˜æ¬¾'}}</td>
<td>
<button @click="markAsPaid(index, 'payable')" class="btn btn-success" v-if="item.status === 'pending'">æ¨™è¨˜ç‚ºå·²ä»˜æ¬¾</button>
<button @click="editPayable(index)" class="btn btn-primary">ç·¨è¼¯</button>
<button @click="deleteRecordByType('payable', index)" class="btn btn-danger">åˆªé™¤</button>
</td>
</template>
</tr>
</tbody>
</table>
</div>
<!-- ç‡Ÿæ¥­ç¨…ç”³å ± -->
<div v-if="financeType === 'tax'">
<h3>ç‡Ÿæ¥­ç¨…ç”³å ±ç®¡ç†</h3>
<div class="form-group">
<label>ç”³å ±æœŸé–“</label>
<select v-model="taxPeriod">
<option value="1">1-2æœˆ</option>
<option value="2">3-4æœˆ</option>
<option value="3">5-6æœˆ</option>
<option value="4">7-8æœˆ</option>
<option value="5">9-10æœˆ</option>
<option value="6">11-12æœˆ</option>
</select>
</div>
<div class="summary">
<h3>ç‡Ÿæ¥­ç¨…ç”³å ±</h3>
<p>éŠ·é …ç¨…é¡:{{ salesTax }}</p>
<p>é€²é …ç¨…é¡:{{ purchaseTax }}</p>
<p>æ‡‰ç´ç¨…é¡:{{ netTax }}</p>
</div>
<table>
<thead>
<tr>
<th>æ—¥æœŸ</th>
<th>é‡‘é¡</th>
<th>ç‹€æ…‹</th>
<th>å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr :key="index" v-for="(record, index) in taxRecords">
<template v-if="editingItem === index">
<td><input type="date" v-model="editForm.date"/></td>
<td><input type="number" v-model="editForm.amount"/></td>
<td>
<select v-model="editForm.status">
<option value="pending">æœªä»˜</option>
<option value="paid">å·²ä»˜</option>
</select>
</td>
<td>
<button @click="saveTaxEdit" class="btn btn-success">å„²å­˜</button>
<button @click="cancelEdit" class="btn btn-danger">å–æ¶ˆ</button>
</td>
</template>
<template v-else="">
<td>{{ record.date }}</td>
<td>{{ record.amount }}</td>
<td>{{ record.status === 'pending' ? 'æœªä»˜' : 'å·²ä»˜' }}</td>
<td>
<button @click="editTax(index)" class="btn btn-primary">ç·¨è¼¯</button>
<button @click="deleteRecordByType('tax', index)" class="btn btn-danger">åˆªé™¤</button>
</td>
</template>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<script>
new Vue({
  el: '#app',
  data: {
    currentView: 'transactions',
    transactions: [],
    vendors: [],
    searchQuery: '',
    vendorSearchQuery: '',
    reportSearchQuery: '',
    selectedMonth: '',
    inventoryType: 'screws',
    screwSearchQuery: '',
    sampleSearchQuery: '',
    screws: [],
    samples: [],
    adjustmentAmount: 0,
    newTransaction: {
      vendor: '',
      type: 'in',
      date: '',
      item: '',
      quantity: 0,
      price: 0,
      remarks: '',
      completed: 'pending'
    },
    sampleOptions: [
      '9P6å‹',
      '9P7å‹', 
      '9P8å‹',
      '15P8å‹',
      '15P10å‹', 
      '25På‹',
      '37På‹',
      '50På‹',
      '9PUå‹',
      '15PUå‹',
      '25PUå‹'
    ],
    newVendor: {
      name: '',
      taxId: '',
      contact: '',
      phone: '',
      fax: '',
      address: '',
      memo: ''
    },
    newScrew: {
      name: '',
      quantity: 0,
      safetyStock: 0
    },
    newSample: {
      name: '',
      quantity: 0,
      safetyStock: 0
    },
    accountsReceivable: [],
    accountsPayable: [],
    newReceivable: {
      date: '',
      vendor: '',
      amount: 0,
      dueDate: '',
      status: 'pending'
    },
    newPayable: {
      date: '',
      vendor: '',
      amount: 0,
      dueDate: '',
      status: 'pending'
    },
    financeType: 'receivable',
    payableSearch: '',
    receivableSearch: '',
    selectedChart: 'bar',
    chartTypes: [{
      value: 'bar',
      label: 'é•·æ¢åœ–'
    }, {
      value: 'line',
      label: 'æŠ˜ç·šåœ–'
    }, {
      value: 'pie',
      label: 'åœ“é¤…åœ–'
    }, {
      value: 'doughnut',
      label: 'ç’°å½¢åœ–'
    }],
    currentChart: null,
    showInventorySummary: false,
    currentDateTime: new Date().toLocaleString('zh-TW', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    }),
    editingItem: null,
    editForm: {},
    isEditing: false,
    taxRecords: [],
    taxPeriod: '1',
    sampleChartType: 'bar',
    sampleInventoryChart: null
  },
  computed: {
    filteredTransactions() {
      return this.transactions
        .filter(t => {
          return t.item && t.item.toLowerCase().includes(this.searchQuery.toLowerCase()) || 
                 t.date && t.date.includes(this.searchQuery) || 
                 t.type === 'in' && 'é€²è²¨'.includes(this.searchQuery) || 
                 t.type === 'out' && 'å‡ºè²¨'.includes(this.searchQuery) || 
                 t.vendor && t.vendor.toLowerCase().includes(this.searchQuery.toLowerCase());
        })
        .sort((a, b) => {
          return new Date(a.date || '') - new Date(b.date || '');
        })
        .map(t => {
          const vendorDetails = t.vendorDetails || this.vendors.find(v => v.name === t.vendor) || {};
          return {
            ...t,
            vendorDisplay: t.vendor || '',
            dateDisplay: t.date || '',
            vendorTooltip: vendorDetails ? 
              `${vendorDetails.name || ''}\nçµ±ç·¨: ${vendorDetails.taxId || ''}\né›»è©±: ${vendorDetails.phone || ''}` : 
              (t.vendor || '')
          };
        });
    },
    filteredVendors() {
      return this.vendors
        .map((v, index) => ({
          ...v,
          nameDisplay: v.name,
          nameTooltip: v.name,
          index: index
        }))
        .filter(v => 
          v.name.toLowerCase().includes(this.vendorSearchQuery.toLowerCase()) || 
          v.taxId.includes(this.vendorSearchQuery) || 
          v.contact.toLowerCase().includes(this.vendorSearchQuery.toLowerCase()) || 
          v.phone.includes(this.vendorSearchQuery) || 
          v.fax.includes(this.vendorSearchQuery) || 
          v.address.toLowerCase().includes(this.vendorSearchQuery.toLowerCase()) || 
          v.memo.toLowerCase().includes(this.vendorSearchQuery.toLowerCase())
        );
    },
    filteredScrews() {
      return this.screws.map(s => {
        const transactions = this.transactions.filter(t => t.item === s.name);
        const inflow = transactions.filter(t => t.type === 'in').reduce((sum, t) => sum + t.quantity, 0);
        const outflow = transactions.filter(t => t.type === 'out').reduce((sum, t) => sum + t.quantity, 0);
        const currentStock = s.quantity + inflow - outflow;
        let status = '';
        let statusClass = '';
        if (currentStock > 2000) {
          status = 'åº«å­˜å……è¶³';
          statusClass = 'status-good';
        } else if (currentStock <= 2000 && currentStock > 500) {
          status = 'é ˆæ³¨æ„æ¨£å“æ•¸é‡';
          statusClass = 'status-warning';
        } else {
          status = 'åº«å­˜ä¸è¶³';
          statusClass = 'status-critical';
        }
        return {
          ...s,
          currentStock,
          status,
          statusClass
        };
      }).filter(s => s.name.toLowerCase().includes(this.screwSearchQuery.toLowerCase()));
    },
    filteredSamples() {
      return this.samples
        .filter(s => s.name.toLowerCase().includes(this.sampleSearchQuery.toLowerCase()))
        .map(s => ({
          ...s,
          status: s.quantity < s.safetyStock ? 'åº«å­˜ä¸è¶³' : 'åº«å­˜å……è¶³',
          statusClass: s.quantity < s.safetyStock ? 'status-low' : 'status-ok'
        }));
    },
    filteredReceivables() {
      return this.accountsReceivable.filter(r => r.vendor.toLowerCase().includes(this.receivableSearch.toLowerCase()) || r.date.includes(this.receivableSearch));
    },
    pendingReceivableTotal() {
      return this.accountsReceivable.filter(r => r.status === 'pending').reduce((sum, r) => sum + r.amount, 0);
    },
    paidReceivableTotal() {
      return this.accountsReceivable.filter(r => r.status === 'paid').reduce((sum, r) => sum + r.amount, 0);
    },
    inTotal() {
      return this.transactions.filter(t => t.type === 'in').reduce((sum, t) => sum + t.quantity * t.price, 0);
    },
    outTotal() {
      return this.transactions.filter(t => t.type === 'out').reduce((sum, t) => sum + t.quantity * t.price, 0);
    },
    balance() {
      return this.outTotal - this.inTotal;
    },
    monthlyInTotal() {
      if (!this.selectedMonth) return 0;
      return this.transactions.filter(t => t.type === 'in' && t.date.startsWith(this.selectedMonth)).reduce((sum, t) => sum + t.quantity * t.price, 0);
    },
    monthlyOutTotal() {
      if (!this.selectedMonth) return 0;
      return this.transactions.filter(t => t.type === 'out' && t.date.startsWith(this.selectedMonth)).reduce((sum, t) => sum + t.quantity * t.price, 0);
    },
    monthlyBalance() {
      return this.monthlyOutTotal - this.monthlyInTotal;
    },
    salesTax() {
      return this.outTotal * 0.05;
    },
    purchaseTax() {
      return this.inTotal * 0.05;
    },
    netTax() {
      return this.salesTax - this.purchaseTax;
    },
    lowStockSamples() {
      return this.samples.filter(s => s.quantity < s.safetyStock).length;
    },
    currentInventorySummary() {
      return {
        screws: this.screws.map(s => ({
          name: s.name,
          quantity: s.quantity,
          status: s.quantity < s.safetyStock ? 'åº«å­˜ä¸è¶³' : 'åº«å­˜å……è¶³'
        })),
        samples: this.samples.map(s => ({
          name: s.name,
          quantity: s.quantity,
          location: '',
          lastUpdated: ''
        }))
      };
    },
    currentStockLevels() {
      const stockLevels = {};
      
      this.samples.forEach(sample => {
        stockLevels[sample.name] = sample.quantity;
      });

      this.transactions.forEach(transaction => {
        if (!stockLevels[transaction.item]) {
          stockLevels[transaction.item] = 0;
        }
        if (transaction.type === 'in') {
          stockLevels[transaction.item] += parseInt(transaction.quantity);
        } else {
          stockLevels[transaction.item] -= parseInt(transaction.quantity);
        }
      });

      return stockLevels;
    }
  },
  methods: {
    exportData() {
      const data = {
        transactions: this.transactions,
        vendors: this.vendors,
        screws: this.screws,
        samples: this.samples,
        accountsReceivable: this.accountsReceivable,
        accountsPayable: this.accountsPayable,
        taxRecords: this.taxRecords
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'inventory-data.json';
      link.click();
      URL.revokeObjectURL(url);
    },
    importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          this.transactions = data.transactions || [];
          this.vendors = data.vendors || [];
          this.screws = data.screws || [];
          this.samples = data.samples || [];
          this.accountsReceivable = data.accountsReceivable || [];
          this.accountsPayable = data.accountsPayable || [];
          this.taxRecords = data.taxRecords || [];
          this.autoSave();
          alert('âœ… è³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
        } catch (error) {
          alert('âŒ åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤');
        }
      };
      reader.readAsText(file);
    },

    autoSave() {
      localStorage.setItem('transactions', JSON.stringify(this.transactions));
      localStorage.setItem('vendors', JSON.stringify(this.vendors));
      localStorage.setItem('screws', JSON.stringify(this.screws));
      localStorage.setItem('samples', JSON.stringify(this.samples));
      localStorage.setItem('accountsReceivable', JSON.stringify(this.accountsReceivable));
      localStorage.setItem('accountsPayable', JSON.stringify(this.accountsPayable));
      localStorage.setItem('taxRecords', JSON.stringify(this.taxRecords));
      this.showSaveSuccess();
    },
    showSaveSuccess() {
      const toast = document.createElement('div');
      toast.className = 'save-toast';
      toast.innerHTML = '<i class="fas fa-check-circle"></i> å­˜æª”æˆåŠŸ';
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.classList.add('fade-out');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    },
    addTransaction() {
      if (!this.newTransaction.item || !this.newTransaction.quantity) {
        alert('è«‹å¡«å¯«å•†å“å’Œæ•¸é‡ï¼');
        return;
      }

      if (this.newTransaction.type === 'out' && 
          this.newTransaction.quantity > (this.currentStockLevels[this.newTransaction.item] || 0)) {
        alert('åº«å­˜ä¸è¶³ï¼Œç„¡æ³•å‡ºè²¨æ­¤æ•¸é‡ï¼');
        return;
      }

      const selectedVendor = this.vendors.find(v => v.name === this.newTransaction.vendor) || {};
      
      this.transactions.push({
        ...this.newTransaction,
        vendorDetails: selectedVendor ? {
          name: selectedVendor.name || '',
          taxId: selectedVendor.taxId || '',
          phone: selectedVendor.phone || ''
        } : {}
      });

      const sample = this.samples.find(s => s.name === this.newTransaction.item);
      if (sample) {
        if (this.newTransaction.type === 'in') {
          sample.quantity += parseInt(this.newTransaction.quantity) || 0;
        } else {
          sample.quantity -= parseInt(this.newTransaction.quantity) || 0;
        }
        sample.lastUpdated = new Date().toLocaleString('zh-TW', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        });
      }

      this.newTransaction = {
        vendor: '',
        type: 'in',
        date: '',
        item: '',
        quantity: 0,
        price: 0,
        remarks: '',
        completed: 'pending'
      };
      this.autoSave();
    },
    deleteRecordByType(type, index) {
      const confirmMessages = {
        transaction: 'ç¢ºèªè¦åˆªé™¤é€™ç­†äº¤æ˜“ç´€éŒ„å—ï¼Ÿ',
        vendor: 'ç¢ºèªè¦åˆªé™¤é€™å€‹å» å•†è³‡æ–™å—ï¼Ÿ',
        screw: 'ç¢ºèªè¦åˆªé™¤é€™ç­†èºçµ²åº«å­˜ç´€éŒ„å—ï¼Ÿ',
        sample: 'ç¢ºèªè¦åˆªé™¤é€™ç­†æ¨£å“åº«å­˜ç´€éŒ„å—ï¼Ÿ', 
        receivable: 'ç¢ºèªè¦åˆªé™¤é€™ç­†æ‡‰æ”¶å¸³æ¬¾å—ï¼Ÿ',
        payable: 'ç¢ºèªè¦åˆªé™¤é€™ç­†æ‡‰ä»˜å¸³æ¬¾å—ï¼Ÿ', 
        tax: 'ç¢ºèªè¦åˆªé™¤é€™ç­†ç¨…å‹™ç´€éŒ„å—ï¼Ÿ'
      };

      if (confirm(confirmMessages[type])) {
        switch(type) {
          case 'transaction':
            const transaction = this.transactions[index];
            const sample = this.samples.find(s => s.name === transaction.item);
            if (sample) {
              if (transaction.type === 'in') {
                sample.quantity -= parseInt(transaction.quantity);
              } else {
                sample.quantity += parseInt(transaction.quantity);
              }
              sample.lastUpdated = new Date().toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
              });
            }
            this.transactions.splice(index, 1);
            break;
          case 'vendor':
            this.vendors.splice(index, 1);
            break; 
          case 'screw':
            this.screws.splice(index, 1);
            break;
          case 'sample': 
            this.samples.splice(index, 1);
            this.updateSampleInventoryChart(); // Update chart after deletion
            break;
          case 'receivable':
            this.accountsReceivable.splice(index, 1);
            break;
          case 'payable':
            this.accountsPayable.splice(index, 1);
            break;
          case 'tax':
            this.taxRecords.splice(index, 1);
            break;
        }
        this.autoSave();
      }
    },
    addVendor() {
      this.vendors.push({
        ...this.newVendor
      });
      this.newVendor = {
        name: '',
        taxId: '',
        contact: '',
        phone: '',
        fax: '',
        address: '',
        memo: ''
      };
      this.autoSave();
    },
    editVendor(index) {
      this.editingItem = index;
      this.editForm = {
        ...this.vendors[index],
        name: this.vendors[index].name,
        taxId: this.vendors[index].taxId,
        contact: this.vendors[index].contact,
        phone: this.vendors[index].phone,
        fax: this.vendors[index].fax,
        address: this.vendors[index].address,
        memo: this.vendors[index].memo
      };
    },
    saveVendorEdit() {
      if (this.editingItem !== null) {
        const updatedVendor = {
          ...this.editForm,
          name: this.editForm.name,
          taxId: this.editForm.taxId,
          contact: this.editForm.contact, 
          phone: this.editForm.phone,
          fax: this.editForm.fax,
          address: this.editForm.address,
          memo: this.editForm.memo 
        };
        this.$set(this.vendors, this.editingItem, updatedVendor);
        this.editingItem = null;
        this.editForm = {};
        this.autoSave();
      }
    },
    deleteVendor(index) {
      if (confirm('ç¢ºèªè¦åˆªé™¤é€™å€‹å» å•†è³‡æ–™å—ï¼Ÿ')) {
        this.vendors.splice(index, 1);
        this.autoSave();
      }
    },
    addScrew() {
      const transactions = this.transactions.filter(t => t.item === this.newScrew.name);
      const inflow = transactions.filter(t => t.type === 'in').reduce((sum, t) => sum + t.quantity, 0);
      const outflow = transactions.filter(t => t.type === 'out').reduce((sum, t) => sum + t.quantity, 0);
      const currentStock = this.newScrew.quantity + inflow - outflow;
      this.screws.push({
        ...this.newScrew,
        currentStock
      });
      this.newScrew = {
        name: '',
        quantity: 0,
        safetyStock: 0
      };
      this.autoSave();
    },
    editScrew(index) {
      this.editingItem = index;
      this.editForm = {
        ...this.screws[index]
      };
      this.isEditing = true;
    },
    saveScrewEdit() {
      if (this.editingItem !== null) {
        const updatedScrew = {
          ...this.editForm
        };
        this.$set(this.screws, this.editingItem, updatedScrew);
        this.editingItem = null;
        this.editForm = {};
        this.isEditing = false;
        this.autoSave();
      }
    },
    adjustInventory(index, type) {
      const amount = parseInt(this.adjustmentAmount);
      if (!amount || amount <= 0) {
        alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸é‡');
        return;
      }
      const sample = this.samples[index];
      if (type === 'out' && sample.quantity < amount) {
        alert('åº«å­˜ä¸è¶³');
        return;
      }
      if (type === 'in') {
        sample.quantity += amount;
      } else {
        sample.quantity -= amount;
      }
      sample.lastUpdated = new Date().toLocaleString('zh-TW', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });
      this.updateSampleInventoryChart(); // Update chart after adjustment
      this.adjustmentAmount = 0;
      this.autoSave();
    },
    addSample() {
      if (!this.newSample.name) {
        alert('è«‹é¸æ“‡æ¨£å“åç¨±');
        return;
      }
      
      this.samples.push({
        ...this.newSample,
        status: this.newSample.quantity < this.newSample.safetyStock ? 'åº«å­˜ä¸è¶³' : 'åº«å­˜å……è¶³',
        statusClass: this.newSample.quantity < this.newSample.safetyStock ? 'status-low' : 'status-ok'
      });
      this.updateSampleInventoryChart(); // Update chart after adding sample
      this.newSample = {
        name: '',
        quantity: 0,
        safetyStock: 0
      };
      this.autoSave();
    },
    editSample(index) {
      this.editingItem = index;
      this.editForm = {
        ...this.samples[index]
      };
      this.isEditing = true;
    },
    saveSampleEdit() {
      if (this.editingItem !== null) {
        const updatedSample = {
          ...this.editForm,
          status: this.editForm.quantity < this.editForm.safetyStock ? 'åº«å­˜ä¸è¶³' : 'åº«å­˜å……è¶³',
          statusClass: this.editForm.quantity < this.editForm.safetyStock ? 'status-low' : 'status-ok'
        };
        this.$set(this.samples, this.editingItem, updatedSample);
        this.updateSampleInventoryChart(); // Update chart after editing
        this.editingItem = null;
        this.editForm = {};
        this.isEditing = false;
        this.autoSave();
      }
    },
    addReceivable() {
      this.accountsReceivable.push({
        ...this.newReceivable
      });
      this.newReceivable = {
        date: '',
        vendor: '',
        amount: 0,
        dueDate: '',
        status: 'pending'
      };
      this.autoSave();
    },
    addPayable() {
      this.accountsPayable.push({
        ...this.newPayable
      });
      this.newPayable = {
        date: '',
        vendor: '',
        amount: 0,
        dueDate: '',
        status: 'pending'
      };
      this.autoSave();
    },
    markAsPaid(index, type) {
      if (type === 'receivable') {
        this.accountsReceivable[index].status = 'paid';
      } else if (type === 'payable') {
        this.accountsPayable[index].status = 'paid';
      }
      this.autoSave();
    },
    editTransaction(index) {
      this.editingItem = index;
      this.editForm = {
        ...this.transactions[index]
      };
    },
    saveTransactionEdit() {
      if (this.editingItem !== null) {
        const updatedTransaction = {
          ...this.editForm
        };
        this.$set(this.transactions, this.editingItem, updatedTransaction);
        this.editingItem = null;
        this.editForm = {};
        this.autoSave();
      }
    },
    editReceivable(index) {
      this.editingItem = index;
      this.editForm = {
        ...this.accountsReceivable[index]
      };
    },
    saveReceivableEdit() {
      if (this.editingItem !== null) {
        const updatedReceivable = {
          ...this.editForm
        };
        this.$set(this.accountsReceivable, this.editingItem, updatedReceivable);
        this.editingItem = null;
        this.editForm = {};
        this.autoSave();
      }
    },
    editPayable(index) {
      this.editingItem = index;
      this.editForm = {
        ...this.accountsPayable[index]
      };
    },
    savePayableEdit() {
      if (this.editingItem !== null) {
        const updatedPayable = {
          ...this.editForm  
        };
        this.$set(this.accountsPayable, this.editingItem, updatedPayable);
        this.editingItem = null;
        this.editForm = {};
        this.autoSave();
      }
    },
    editTax(index) {
      this.editingItem = index;
      this.editForm = {
        ...this.taxRecords[index]
      };
    },
    saveTaxEdit() {
      if (this.editingItem !== null) {
        const updatedTax = {
          ...this.editForm
        };
        this.$set(this.taxRecords, this.editingItem, updatedTax);
        this.editingItem = null; 
        this.editForm = {};
        this.autoSave();
      }
    },
    updateChart() {
      // Your chart update logic here
    },
    updateFinanceChart() {
      // Your finance chart update logic here
    },
    updateInventoryChart() {
      // Your inventory chart update logic here
    },
    updateSampleInventoryChart() {
      if (this.sampleInventoryChart) {
        this.sampleInventoryChart.destroy();
      }

      const ctx = document.getElementById('sampleInventoryChart').getContext('2d');
      
      const labels = this.samples.map(s => s.name);
      const quantities = this.samples.map(s => s.quantity);
      const safetyLevels = this.samples.map(s => s.safetyStock);
      
      const config = {
        type: this.sampleChartType,
        data: {
          labels: labels,
          datasets: [{
            label: 'ç¾å­˜æ•¸é‡',
            data: quantities,
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          },
          {
            label: 'å®‰å…¨åº«å­˜é‡',
            data: safetyLevels,
            backgroundColor: 'rgba(255, 99, 132, 0.5)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                font: {
                  size: 14
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true
            },
            x: {
              ticks: {
                font: {
                  size: 12
                }
              }
            }
          }
        }
      };

      if (this.sampleChartType === 'pie' || this.sampleChartType === 'doughnut') {
        config.data.datasets = [{
          label: 'ç¾å­˜æ•¸é‡',
          data: quantities,
          backgroundColor: [
            'rgba(255, 99, 132, 0.5)',
            'rgba(54, 162, 235, 0.5)',
            'rgba(255, 206, 86, 0.5)',
            'rgba(75, 192, 192, 0.5)',
            'rgba(153, 102, 255, 0.5)',
            'rgba(255, 159, 64, 0.5)',
            'rgba(199, 199, 199, 0.5)',
            'rgba(83, 102, 255, 0.5)',
            'rgba(40, 159, 64, 0.5)',
            'rgba(210, 199, 199, 0.5)',
            'rgba(78, 52, 199, 0.5)',
          ],
          borderColor: [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)', 
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)',
            'rgba(199, 199, 199, 1)',
            'rgba(83, 102, 255, 1)',
            'rgba(40, 159, 64, 1)',
            'rgba(210, 199, 199, 1)',
            'rgba(78, 52, 199, 1)',
          ],
          borderWidth: 1
        }];
      }

      this.sampleInventoryChart = new Chart(ctx, config);
    },
    cancelEdit() {
      this.editingItem = null; 
      this.editForm = {};
    }
  },
  mounted() {
    try {
      this.transactions = (JSON.parse(localStorage.getItem('transactions')) || []).map(t => ({
        ...t,
        vendor: t.vendor || '',
        date: t.date || '',
        item: t.item || '',
        quantity: t.quantity || 0,
        price: t.price || 0,
        remarks: t.remarks || '',
        completed: t.completed || 'pending'
      }));
      
      // Ensure vendor details are attached to existing transactions
      this.transactions = this.transactions.map(t => {
        const vendorDetails = this.vendors.find(v => v.name === t.vendor);
        return {
          ...t,
          vendorDetails: vendorDetails ? {
            name: vendorDetails.name || '',
            taxId: vendorDetails.taxId || '',
            phone: vendorDetails.phone || ''
          } : {}
        };
      });

      this.vendors = JSON.parse(localStorage.getItem('vendors')) || [];
      this.screws = JSON.parse(localStorage.getItem('screws')) || [];
      this.samples = JSON.parse(localStorage.getItem('samples')) || [];
      this.accountsReceivable = JSON.parse(localStorage.getItem('accountsReceivable')) || [];
      this.accountsPayable = JSON.parse(localStorage.getItem('accountsPayable')) || [];
      this.taxRecords = JSON.parse(localStorage.getItem('taxRecords')) || [];
      
      this.$nextTick(() => {
        this.updateSampleInventoryChart();
      });
    } catch (err) {
      console.error('Error loading data:', err);
      // Initialize with empty arrays if there's an error
      this.transactions = [];
      this.vendors = [];
      this.screws = [];
      this.samples = [];
      this.accountsReceivable = [];
      this.accountsPayable = [];
      this.taxRecords = [];
    }
  }
});
</script>
</body>
